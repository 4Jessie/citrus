<project name="flight-booking" basedir="." default="init" xmlns:artifact="urn:maven-artifact-ant">
	<property file="src/main/resources/test.properties"/>
	
	<target name="init">
	    <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="urn:maven-artifact-ant">
	        <classpath>
	            <pathelement location="maven-ant-tasks-2.0.7.jar"/>
	        </classpath>
	    </typedef>
	
	    <artifact:dependencies pathId="classpath">
	        <dependency groupId="com.consol.citrus" artifactId="citrus-core" version="3.0"/>
	    	<dependency groupId="com.consol.citrus" artifactId="citrus-tibco" version="3.0"/>
	    	<dependency groupId="com.consol.citrus" artifactId="citrus-http" version="3.0"/>
	    	<dependency groupId="hsqldb" artifactId="hsqldb" version="1.8.0.7"/>
	        <dependency groupId="org.slf4j" artifactId="slf4j-log4j12" version="1.5.6"/>
	    </artifact:dependencies>
	</target>
	
	<target name="run.all.tests" depends="init">
		<mkdir dir="target/test-output"/>
		
		<java classname="com.consol.citrus.CitrusApplication" fork="true" failonerror="true">
            <classpath refid="classpath"/>
			<classpath path="src/main/tests"/>
			<classpath path="src/main/resources"/>
			<arg line="-testdir src/main/tests"/>
			<jvmarg value="-javaagent:spring-agent-2.5.6.jar"/>
        </java>
		
		<antcall target="junit.report"/>
	</target>
	
	<target name="run.single.test" depends="init">
    	<mkdir dir="target/test-output"/>
    	
   	 	<touch file="target/test.history"/>
    	
    	<loadproperties srcfile="target/test.history"/>
    	
    	<echo message="Last test executed: ${last.test.executed}"/>

    	<input message="Enter test name or leave empty for last test executed:" addproperty="testclass" defaultvalue="${last.test.executed}"/>
    	
    	<propertyfile file="target/test.history">
			<entry key="last.test.executed" type="string" value="${testclass}"/>
		</propertyfile>

        <java classname="com.consol.citrus.CitrusApplication" fork="true" failonerror="true">
            <classpath refid="classpath"/>
        	<classpath path="src/main/tests"/>
        	<classpath path="src/main/resources"/>
        	<arg line="-test ${testclass} -testdir src/main/tests"/>
        	<jvmarg value="-javaagent:spring-agent-2.5.6.jar"/>
        </java>
    </target>
	
	<target name="create.new.testcase" depends="init" description="Creates a new empty test">
        <input message="Enter test name:" addproperty="test.name"/>
        <input message="Enter test description:" addproperty="test.description"/>
        <input message="Enter your name:" addproperty="test.author.local" defaultvalue="${test.author}"/>
        <input message="Enter subfolder in test directory:" addproperty="test.subfolder"/>

		<java classname="com.consol.citrus.util.TestCaseCreator">
            <classpath refid="classpath"/>
            <arg value="${test.name}"/>
			<arg value="${test.author}"/>
			<arg value="${test.description}"/>
			<arg value="src/main/tests/${test.subfolder}"/>
        </java>
    </target>
	
	<target name="junit.report">
		<mkdir dir="target/test-report"/>
		
		<junitreport todir="target/test-report">
			<fileset dir="target/test-output">
				<include name="test-results.xml"/>
			</fileset>
			
			<report todir="target/test-report"/>
		</junitreport>
	</target>
	
    <target name="start.http.stub" depends="init">
        <java classname="com.consol.citrus.http.HttpServer" fork="true" failonerror="true">
            <classpath refid="classpath" />
            <classpath path="src/main/resources" />
        </java>
    </target>
    
    <target name="stop.http.stub" depends="init">
        <java classname="com.consol.citrus.http.HttpServer" fork="true" failonerror="true">
            <arg line="quit" />
            <classpath refid="classpath" />
            <classpath path="src/main/resources" />
        </java>
    </target>
    
    <target name="restart.http.stub" depends="init">
        <antcall target="stop.http.stub"/>
        <antcall target="start.http.stub"/>
    </target>
	
	<target name="create.html.doc" depends="init">
        <property file="src/main/resources/testdoc.properties" />
        
		<mkdir dir="${xsl.output.dir}"/>
		
        <java classname="com.consol.citrus.doc.HtmlTestDocGenerator">
        	<classpath refid="classpath" />    
            
            <arg value="${html.xslt.file}"/>
            <arg value="${html.output.file}"/>
            <arg value="${xsl.src.dir}"/>
            <arg value="${html.template.file}"/>
        </java>
		
		<copy todir="${xsl.output.dir}/${img.dir}">
            <fileset dir="src/main/resources/${img.dir}">
                <include name="*"/>
            </fileset>
        </copy>
        
        <zip destfile="${html.output.file}.zip">
            <fileset dir="${xsl.output.dir}">
                <include name="*.html"/>
                <include name="img/*"/>
            </fileset>
        </zip>
    </target>
    
    <target name="create.xls.doc" depends="init">
        <property file="src/main/resources/testdoc.properties" />
        
    	<mkdir dir="${xsl.output.dir}"/>
    	
        <java classname="com.consol.citrus.doc.ExcelTestDocGenerator">
        	<classpath refid="classpath" />
            
            <arg value="${xls.xslt.file}"/>
            <arg value="${xls.output.file}"/>
            <arg value="${xsl.src.dir}"/>
            <arg value="${xls.template.file}"/>
        </java>
    </target>
    
    <target name="create.svg.doc" depends="init">
        <property file="src/main/resources/testdoc.properties" />
        
        <java classname="com.consol.citrus.doc.SvgTestDocGenerator">
        	<classpath refid="classpath" />    
            
            <arg value="${svg.xslt.file}"/>
            <arg value="${test.directory}"/>
        </java>
    </target>
		
</project>
