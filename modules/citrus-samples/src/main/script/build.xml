<project name="flight-booking" basedir="." default="run.all.tests" xmlns:artifact="urn:maven-artifact-ant">
		
    <path id="classpath">
        <pathelement path="tests"/>
        <fileset dir="../dist">
            <include name="*.jar"/>
        </fileset>
		<fileset dir="../lib">
            <include name="*.jar"/>
        </fileset>
    	<fileset dir="lib">
            <include name="*.jar"/>
        </fileset>
    </path>
    
    <target name="echo.classpath">	
		<!-- get the source compile classpath in a printable form -->
		<pathconvert pathsep="${line.separator}|   |-- "
		             property="echo.classpath"
		             refid="classpath">
		</pathconvert>
	
		<echo message="${echo.classpath}"/>
	</target>
    
	<target name="run.all.tests" description="Runs all tests">
		<mkdir dir="test-output"/>
		
		<java classname="com.consol.citrus.CitrusApplication" fork="true" failonerror="true">
            <classpath refid="classpath"/>
			<classpath path="src/main/tests"/>
			<jvmarg value="-javaagent:lib/spring-agent-2.5.6.jar"/>
        </java>
		
		<antcall target="junit.report"/>
	</target>
	
	<target name="run.single.test" description="Runs a single test by name">
    	<mkdir dir="test-output"/>
    	
   	 	<touch file="test.history"/>
    	
    	<loadproperties srcfile="test.history"/>
    	
    	<echo message="Last test executed: ${last.test.executed}"/>

    	<input message="Enter test name or leave empty for last test executed:" addproperty="testclass" defaultvalue="${last.test.executed}"/>
    	
    	<propertyfile file="test.history">
			<entry key="last.test.executed" type="string" value="${testclass}"/>
		</propertyfile>

        <java classname="com.consol.citrus.CitrusApplication" fork="true" failonerror="true">
            <classpath refid="classpath"/>
        	<classpath path="src/main/tests"/>
        	<arg line="-test ${testclass}"/>
        	<jvmarg value="-javaagent:lib/spring-agent-2.5.6.jar"/>
        </java>
    </target>
	
	<target name="create.new.testcase" description="Creates a new empty test case">
        <input message="Enter test name:" addproperty="test.name"/>
        <input message="Enter test description:" addproperty="test.description"/>
        <input message="Enter your name:" addproperty="test.author.local" defaultvalue="${test.author}"/>
        <input message="Enter subfolder in test directory:" addproperty="test.subfolder"/>

		<java classname="com.consol.citrus.util.TestCaseCreator">
            <classpath refid="classpath"/>
            <arg value="${test.name}"/>
			<arg value="${test.author}"/>
			<arg value="${test.description}"/>
			<arg value="tests/${test.subfolder}"/>
        </java>
    </target>
	
	<target name="junit.report">
		<mkdir dir="test-report"/>
		
		<junitreport todir="test-report">
			<fileset dir="test-output">
				<include name="test-results.xml"/>
			</fileset>
			
			<report todir="test-report"/>
		</junitreport>
	</target>
		
</project>
